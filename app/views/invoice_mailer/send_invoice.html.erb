<table width="100%" cellpadding="0" cellspacing="0" style="background:#f4f6f8;padding:20px;">
  <tr>
    <td align="center">
      <table width="700" cellpadding="0" cellspacing="0" style="background:#ffffff;border:1px solid #dddddd;font-family:Arial,Helvetica,sans-serif;">

        <!-- Header -->
        <tr>
          <td style="padding:20px;text-align:center;">
            <h3 style="margin:0;font-size:20px;">Invoice</h3>
          </td>
        </tr>

        <!-- Customer Email -->
        <tr>
          <td style="padding:10px 20px;">
            <table width="100%" cellpadding="6" cellspacing="0">
              <tr>
                <td width="30%" style="font-weight:bold;">Customer Email</td>
                <td width="70%" style="color:#555555;"><%= @customer.email %></td>
              </tr>
            </table>
          </td>
        </tr>

        <!-- Items Table -->
        <tr>
          <td style="padding:10px 20px;">
            <table width="100%" border="1" cellpadding="6" cellspacing="0" style="border-collapse:collapse;font-size:13px;">
              <thead>
                <tr style="background:#f1f1f1;">
                  <th align="left">Product ID</th>
                  <th align="right">Unit Price</th>
                  <th align="right">Quantity</th>
                  <th align="right">Purchase Price</th>
                  <th align="right">Tax %</th>
                  <th align="right">Tax Payable</th>
                  <th align="right">Total Price</th>
                </tr>
              </thead>
              <tbody>
                <% subtotal = 0 %>
                <% total_tax = 0 %>

                <% @bill_details.each do |item| %>
                  <% product = item.product %>
                  <% purchase_price = product.price * item.quantity %>
                  <% tax_amount = purchase_price * product.tax_percentage / 100.0 %>
                  <% subtotal += purchase_price %>
                  <% total_tax += tax_amount %>

                  <tr>
                    <td><%= product.product_id %></td>
                    <td align="right">₹<%= product.price %></td>
                    <td align="right"><%= item.quantity %></td>
                    <td align="right">₹<%= purchase_price.round(2) %></td>
                    <td align="right"><%= product.tax_percentage %> %</td>
                    <td align="right">₹<%= tax_amount.round(2) %></td>
                    <td align="right">₹<%= item.line_total.round(2) %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </td>
        </tr>

        <!-- Totals -->
        <tr>
          <td style="padding:10px 20px;">
            <% net_total = subtotal + total_tax %>
            <% rounded_total = net_total.floor %>

            <table width="100%" cellpadding="6" cellspacing="0" style="font-size:13px;">
              <tr>
                <td align="right" width="80%">Total price without tax:</td>
                <td align="right">₹<%= subtotal.round(2) %></td>
              </tr>
              <tr>
                <td align="right">Total tax payable:</td>
                <td align="right">₹<%= total_tax.round(2) %></td>
              </tr>
              <tr>
                <td align="right">Net price of purchased items:</td>
                <td align="right">₹<%= net_total.round(2) %></td>
              </tr>
              <tr>
                <td align="right">Rounded down net price:</td>
                <td align="right">₹<%= rounded_total %></td>
              </tr>
            </table>
          </td>
        </tr>

        <!-- Footer -->
        <tr>
          <td style="padding:20px;text-align:center;font-size:12px;color:#777777;">
            Thank you for your purchase
          </td>
        </tr>

      </table>
    </td>
  </tr>
</table>
